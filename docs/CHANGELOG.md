# 更新日志

## v0.5.3 (Beta Release - 待发布)

### 新增功能

1. **文档导出功能** (#3)
   - 支持导出为 PDF 格式（使用 html2pdf.js，完美支持中文）
   - 支持导出为 DOCX 格式（完整主题样式支持）
   - 导出文档自动应用氛围协议主题样式（背景颜色、文字颜色、强调色等）
   - 导出按钮集成在顶部工具栏，支持悬停菜单选择格式
   - PDF 和 DOCX 导出支持所有块类型（标题、段落、引用、代码块、列表）
   - DOCX 导出支持文档背景色、段落背景色、引用边框等样式
   - **导出文件自动保存到 Documents/vana 目录**
   - **支持文件名冲突自动递增（例如：document(1).pdf）**

2. **文本格式化功能**
   - 添加粗体（Bold）格式化按钮和快捷键（Ctrl+B / Cmd+B）
   - 添加斜体（Italic）格式化按钮和快捷键（Ctrl+I / Cmd+I）
   - 添加下划线（Underline）格式化按钮和快捷键（Ctrl+U / Cmd+U）
   - 添加删除线（Strikethrough）格式化按钮和快捷键（Ctrl+Shift+X / Cmd+Shift+X）
   - 文本格式化按钮集成在顶部工具栏，支持实时状态反馈
   - PDF 和 DOCX 导出完整支持文本格式化

### Bug 修复

3. **Windows 平台同步问题修复** (#2)
   - 修复 Windows 平台下 Git 同步失败的问题（"无法从远程获取更新"）
   - 添加 Windows 平台 SSL 证书验证回调，解决 Schannel 证书吊销检查失败问题
   - 同时修复 `fetch_from_remote` 和 `push_to_remote` 函数的证书验证问题

4. **导出功能修复**
   - 修复 PDF 导出中文乱码问题（改用 html2pdf.js）
   - 修复 PDF 文字显示范围问题
   - 修复 DOCX 导出背景颜色不显示问题
   - 修复 Tauri 环境下 PDF 导出的窗口弹出问题
   - 修复 html2pdf.js 的 SSR 问题（使用动态导入）
   - 优化 DOCX 导出的段落样式和间距

### 用户体验改进

5. **UI 交互优化**
   - 修复格式菜单点击外部不消失的问题（桌面端）
   - 优化导出按钮悬停判定区域，防止菜单意外消失
   - 添加过渡区域确保鼠标移动到菜单时不会触发关闭

6. **编辑器交互优化**
   - 修复拖拽选择文本时点击事件覆盖选择的问题
   - 修复点击编辑器 margin 区域无法聚焦的问题
   - 添加拖拽距离检测（超过 5px 认为是拖拽而非点击）
   - 优化点击检测逻辑，区分容器和内部文本节点

### 技术改进

7. **依赖包更新**
   - 新增 `html2pdf.js` 和 `@types/html2pdf.js` - PDF 生成库
   - 新增 `@tiptap/extension-underline` - 下划线扩展
   - 新增 `docx` - DOCX 文档生成库
   - 移除 `jspdf` 和 `@types/jspdf`（改用 html2pdf.js）

8. **后端命令新增**
   - 新增 `save_export_file` Tauri 命令，支持保存文件到 Documents/vana 目录
   - 支持文件名冲突自动处理

## v0.5.2.1 (Beta Release)

### 核心功能

1. **Tauri 基础架构**
   - Tauri v2 项目初始化
   - Next.js App Router 集成
   - TypeScript 配置

2. **加密模块**
   - AES-256-GCM 加密/解密
   - 密钥管理（系统 Keychain）
   - 加密文件读写

3. **文件系统操作**
   - 加密文件读写 API
   - 目录列表功能
   - 文件信息查询

4. **Git 集成**
   - Git 仓库初始化
   - 自动提交功能
   - 仓库状态查询
   - 仓库验证功能（检查初始化、提交历史）
   - 提交历史查询
   - **单分支 `main` 工作流**（不使用 draft）
   - **远程同步操作**（fetch / fast-forward / rebase / push）
   - **冲突检测和处理**：支持 ours/theirs/copyBoth（保留两者会生成 `*_conflict_<timestamp>` 副本）

5. **双层保存策略**
   - Tier 1: 防抖磁盘保存（停止打字 2 秒后）
   - Tier 2: Git 自动提交（文档关闭/后台/15分钟）

6. **氛围协议**
   - .vnode.json 配置读写
   - 主题自动加载

7. **多主题 UI**
   - 4 种主题：arcane（奥术）、terminal（终端）、rusty（废土）、vellum（极简）
   - 主题切换功能
   - 响应式设计
   - 主题预览组件（仅供预览，不应用到实际文件）

8. **核心 UI 组件**
   - 侧边栏文件浏览器
   - 块式编辑器
   - 环形菜单
   - 主题提供者
   - 自定义标题栏（窗口控制）
   - 同步状态指示器

9. **PAT 存储和管理**
   - GitHub PAT Token 安全存储（Keychain）
   - PAT 的存储、读取、删除功能
   - 前端 PAT 配置界面

10. **远程仓库配置**
    - 远程仓库添加、查询、删除
    - 支持 HTTPS + PAT 认证
    - 前端远程仓库配置界面

11. **GitHub 云端同步**
    - 同步状态显示
    - 手动同步功能
    - 自动同步集成（在 Git 提交后触发）

12. **Git 维护功能**
    - Git GC 实现（轻量维护策略）
    - 打包引用和松散对象
    - 清理不可达对象

13. **二维码功能**
    - 二维码显示组件（桌面端生成 PAT Token 二维码）
    - 二维码扫描组件（移动端扫描导入 PAT Token）
    - 设置页面完整集成
    - 移动端/桌面端自动适配

### UI/UX 增强

- **文件树可视化**：添加垂直线条显示层级结构
- **自动保存**：切换文件时自动提交，移除保存提示
- **提交优化**：检测到无文件更改时跳过提交
- **PAT 安全显示**：设置页面隐藏 PAT，仅显示远程仓库 URL
- **URL 换行优化**：修复设置页面 URL 显示超出边界问题
- **右键菜单定位**：修复左侧文件树右键菜单位置偏移问题
- **文件创建路径**：修复新建文件/目录时路径错误问题
- **主题选择器**：移至顶部导航栏，提供预览功能

### 技术改进

- **Git 库迁移**：从 `gix` 完全迁移到 `git2-rs`（libgit2 绑定）
- **单分支工作流**：移除 `draft` 分支，统一使用 `main` 分支
- **Rebase 冲突处理**：实现交互式冲突解决 UI
- **窗口关闭逻辑**：实现自定义标题栏，确保关闭时正确同步
- **Git 配置处理**：修复 multivar 配置错误，使用 `config.snapshot()` 处理重复配置

### 待实现

- 生物识别认证
- Git 历史折叠功能
- 更多主题和自定义主题
- 文档搜索功能
- 导出功能（PDF、Markdown 等）

